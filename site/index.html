<html>

<head>
<meta name='viewport' content='width=1000'>
<title>Aikonic NFT Vaults</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.7.4/dist/web3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>

</head>
<body onmouseup="hidePanels()">

<style>
@font-face {
	font-family: Superstar;
	src: url("superstar.ttf");
}

.shadow {
	filter: drop-shadow(5px 5px 2px #000000FF);
}

body {
	font-family: Consolas;
	font-weight: bold;
	font-size: 16px;
	background-color: black;
	color: #FFFFFF;
}

.bgimage {
	position: fixed;
	background: url('./bg.png');
	filter: blur(4px);
	opacity: .5;
	background-attachment: fixed;
	background-repeat: no-repeat;
	background-size: auto 100%;
	background-position: center center;
	transform: translateZ(100px) scale(1.25);	
	object-fit: fill;
	left: 0px; top: 0px;
	width: 100%;
	height: 100%;
	overflow: hidden;
	z-index: -10;
}

.main-container {
	position: absolute;
	left: 50%;
	top: 7.5%;
	transform: translate(-50%, 0);
	min-width: 1000px;
	padding-left: .6vw;
	padding-right: .6vw;
}

.superstar {
	font-family: Superstar,"sans-serif";
}

oldbody {
	background: linear-gradient(113deg, rgba(14,0,15,1) 0%, rgba(116,61,116,1) 72%, rgba(14,0,15,1) 100%);
}

.menubar {
	position: fixed;
	background: #3E113FDA;
	border: 2px solid #BABABA; border-radius: 5px;	
	left: 0;
	top: 0;
	width: 99.5%;
	height: 48px;
	z-index: 10;
}

.groupbox {
	border: 2px solid #BABABA; border-radius: 5px;	
	background: #3E113FBA;
	width: 100%;
	backdrop-filter: blur(8px);
	padding: 8px 0 8px 0;
}

.vaultbox {
	border: 2px solid #BABABA; border-radius: 5px;	
	background: #3E113FBA;	
	backdrop-filter: blur(8px);
	padding: 8px 0 8px 0;
	margin: 16px 0 0 0;
	width: 488px;
	height: fit-content;
}

.vault-image {
	width: 200px;
	height: 200px;
	background: black;
	margin: 0 16px 0 16px;
	border-radius: 28px;
}

.vault-container {
	position: absolute;
	width: 1000px;
	left: 50%;
	transform: translate(-50%, 0);
	margin: 16px 0 0 0;
}

.vault-container img {	
	width: 196px;
	height: auto;
	border: white solid 2px;
	margin-top: 50%;
	transform: translate(0, -50%);
}

.vault-info {
	margin: 16px 16px 0 0px;
	text-align: right;
	width: 100%;
}

.previewbox {	
	position: fixed;
	background: #3E113FBA;
	width: 600px;
	height: 600px;
	left: 50%;
	top: 50%;
	padding: 8px 0 8px 0;
	transform: translate(-50%, -50%);
	border: 2px solid #BABABA;
	border-radius: 28px;
	backdrop-filter: blur(8px);
	z-index: 5;
}

.previewbox img {
	width: 100%;
	height: auto;
	background-color: black;
	margin-top: 50%;
	transform: translate(0, -50%);	
}

.buttonbox {
	position: absolute;
	left: 50%; margin: 16px 0 0 0;
	transform: translate(-50%, 0);
	display: flex
}

.error-panel {
	position: absolute;
	background: black;
	padding: 16px;
	border: solid 2px #BA70BA;
	border-radius: 16px;	
	height: fit-content;
	width: fit-content;
	left: -50%;
	top: 50%;
	text-align: center;
	transform: translate(-50%, -50%);
	z-index: 100
}

.button {
	background: #BA70BA;
	padding: 4px 0 4px 0;
	margin: 0 16px 8px 16px;
	width: 125px;
	height: fit-content;
	cursor: hand;
}

.button:hover {
	background: green;
}
</style>

<script>

const CHAIN_ID = 5777;//43114;
const MAX_PROFIT = 3 * 10e18;
const PRECISION = 1e18;
const MAX_UINT = "115792089237316195423570985008687907853269984665640564039457584007913129639935";

/*
 * Checks for a valid metamask instance and requests the account
 * Returns true if the user connected to the site
 */
const Web3Enabled = async () => {
	if(typeof window.ethereum !== "undefined") {
		await window.ethereum.request({method: 'eth_requestAccounts'}).then(function(result) {
			console.log("[SUCCESS] " + result);
		}, function(error) {
			console.log("[ERROR " + error.code + "] " + error.message);
		});

		window.web3 = new Web3(window.ethereum);
		return true;
	} else {
		console.log("Metamask is not installed!");
	}
	return false;
}

/*
 * Checks to make sure we're on the right chain and if not
 * invoke a switch
 */
 
const switchNetwork = async(chainId) => {
	var currentChainId = window.web3.eth.net.getId();
	if(currentChainId !== chainId) {
		await window.ethereum.request(
		{
			method: 'wallet_switchEthereumChain',
			params: [{ chainId: window.web3.utils.toHex(chainId) }]
		});
	}
}

const WINE_TOKEN = "0x233206a958B3518478D05B6843af445630188685";
const WINE_TOKEN_ABI = [{"inputs": [{"internalType": "uint256","name": "initialSupply","type": "uint256"}],"stateMutability": "nonpayable","type": "constructor"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "owner","type": "address"},{"indexed": true,"internalType": "address","name": "spender","type": "address"},{"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],"name": "Approval","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "from","type": "address"},{"indexed": true,"internalType": "address","name": "to","type": "address"},{"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],"name": "Transfer","type": "event"},{"inputs": [{"internalType": "address","name": "owner","type": "address"},{"internalType": "address","name": "spender","type": "address"}],"name": "allowance","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "approve","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "balanceOf","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "decimals","outputs": [{"internalType": "uint8","name": "","type": "uint8"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "subtractedValue","type": "uint256"}],"name": "decreaseAllowance","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "addedValue","type": "uint256"}],"name": "increaseAllowance","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "name","outputs": [{"internalType": "string","name": "","type": "string"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "symbol","outputs": [{"internalType": "string","name": "","type": "string"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "totalSupply","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "to","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "transfer","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "from","type": "address"},{"internalType": "address","name": "to","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "transferFrom","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"}];
const VINTAGE_TOKEN = "0x726eb871C9178c17aadD1060C66C5120f63b90ee";
const VINTAGE_TOKEN_ABI = [{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "owner","type": "address"},{"indexed": true,"internalType": "address","name": "spender","type": "address"},{"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],"name": "Approval","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "previousOwner","type": "address"},{"indexed": true,"internalType": "address","name": "newOwner","type": "address"}],"name": "OwnershipTransferred","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "from","type": "address"},{"indexed": true,"internalType": "address","name": "to","type": "address"},{"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],"name": "Transfer","type": "event"},{"inputs": [],"name": "NUM_PROMOTIONAL_VINTAGEWINE","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "NUM_VINTAGEWINE_AVAX_LP","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "NUM_VINTAGEWINE_USDC_LP","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "ONE_VINTAGEWINE","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "USDCLPVintageWineMinted","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "owner","type": "address"},{"internalType": "address","name": "spender","type": "address"}],"name": "allowance","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "approve","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "avaxLPVintageWineMinted","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "balanceOf","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "_from","type": "address"},{"internalType": "uint256","name": "_amount","type": "uint256"}],"name": "burn","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "cellarAddress","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "decimals","outputs": [{"internalType": "uint8","name": "","type": "uint8"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "subtractedValue","type": "uint256"}],"name": "decreaseAllowance","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "addedValue","type": "uint256"}],"name": "increaseAllowance","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_to","type": "address"},{"internalType": "uint256","name": "_amount","type": "uint256"}],"name": "mint","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "mintAvaxLPVintageWine","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_to","type": "address"}],"name": "mintPromotionalVintageWine","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "mintUSDCLPVintageWine","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_to","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "mintVintageWine","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "name","outputs": [{"internalType": "string","name": "","type": "string"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "owner","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "promotionalVintageWineMinted","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "renounceOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_cellarAddress","type": "address"}],"name": "setCellarAddress","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "_numVintageWineAvaxLp","type": "uint256"}],"name": "setNumVintageWineAvaxLp","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_upgradeAddress","type": "address"}],"name": "setUpgradeAddress","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_wineryAddress","type": "address"}],"name": "setWineryAddress","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "symbol","outputs": [{"internalType": "string","name": "","type": "string"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "totalSupply","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "to","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "transfer","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_from","type": "address"},{"internalType": "uint256","name": "_amount","type": "uint256"}],"name": "transferForUpgradesFees","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "from","type": "address"},{"internalType": "address","name": "to","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "transferFrom","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "newOwner","type": "address"}],"name": "transferOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_from","type": "address"},{"internalType": "uint256","name": "_amount","type": "uint256"}],"name": "transferToCellar","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "upgradeAddress","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "wineryAddress","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"}];
const CELLAR = "0x30dc5DD73c04984A4720D2443D8488f5A59374b4";
const CELLAR_ABI = [{"inputs": [{"internalType": "contract VintageWine","name": "_vintageWine","type": "address"}],"stateMutability": "nonpayable","type": "constructor"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "owner","type": "address"},{"indexed": true,"internalType": "address","name": "spender","type": "address"},{"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],"name": "Approval","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "previousOwner","type": "address"},{"indexed": true,"internalType": "address","name": "newOwner","type": "address"}],"name": "OwnershipTransferred","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"internalType": "address","name": "account","type": "address"}],"name": "Paused","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "from","type": "address"},{"indexed": true,"internalType": "address","name": "to","type": "address"},{"indexed": false,"internalType": "uint256","name": "value","type": "uint256"}],"name": "Transfer","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"internalType": "address","name": "account","type": "address"}],"name": "Unpaused","type": "event"},{"inputs": [],"name": "DELAYED_UNSTAKE_BURN_PERCENT","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "DELAYED_UNSTAKE_LOCKUP_PERIOD","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "QUICK_UNSTAKE_BURN_PERCENT","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "QUICK_UNSTAKE_CONTRIBUTION_PERCENT","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "owner","type": "address"},{"internalType": "address","name": "spender","type": "address"}],"name": "allowance","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "approve","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "balanceOf","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_amount","type": "uint256"}],"name": "claimDelayedUnstake","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "decimals","outputs": [{"internalType": "uint8","name": "","type": "uint8"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "subtractedValue","type": "uint256"}],"name": "decreaseAllowance","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "frozenVintageWine","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "spender","type": "address"},{"internalType": "uint256","name": "addedValue","type": "uint256"}],"name": "increaseAllowance","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "name","outputs": [{"internalType": "string","name": "","type": "string"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "owner","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "paused","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_share","type": "uint256"}],"name": "prepareDelayedUnstake","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "_share","type": "uint256"}],"name": "quickUnstake","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "renounceOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "_startTime","type": "uint256"}],"name": "setStakeStartTime","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "_amount","type": "uint256"}],"name": "stake","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "stakeStarted","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "stakeTime","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "symbol","outputs": [{"internalType": "string","name": "","type": "string"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "totalSupply","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "to","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "transfer","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "from","type": "address"},{"internalType": "address","name": "to","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "transferFrom","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "newOwner","type": "address"}],"name": "transferOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "","type": "address"}],"name": "unlockAmounts","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "","type": "address"}],"name": "unlockTimestamps","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "vintageWine","outputs": [{"internalType": "contract VintageWine","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "vintageWineBalance","outputs": [{"internalType": "uint256","name": "balance","type": "uint256"}],"stateMutability": "view","type": "function"}];
const VINEYARD = "0x8782d97BBEB5E108De3c5e8B8C5A875c5C9292Aa";
const VINEYARD_ABI = [{"inputs": [{"internalType": "address","name": "_wine","type": "address"},{"internalType": "uint256","name": "_poolStartTime","type": "uint256"}],"stateMutability": "nonpayable","type": "constructor"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "user","type": "address"},{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "amount","type": "uint256"}],"name": "Deposit","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "user","type": "address"},{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "amount","type": "uint256"}],"name": "EmergencyWithdraw","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "user","type": "address"},{"indexed": false,"internalType": "uint256","name": "amount","type": "uint256"}],"name": "RewardPaid","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "user","type": "address"},{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "amount","type": "uint256"}],"name": "Withdraw","type": "event"},{"inputs": [],"name": "TOTAL_REWARDS","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_allocPoint","type": "uint256"},{"internalType": "contract IERC20","name": "_token","type": "address"},{"internalType": "bool","name": "_withUpdate","type": "bool"},{"internalType": "uint256","name": "_lastRewardTime","type": "uint256"}],"name": "add","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "_pid","type": "uint256"},{"internalType": "uint256","name": "_amount","type": "uint256"}],"name": "deposit","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "_pid","type": "uint256"}],"name": "emergencyWithdraw","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "_fromTime","type": "uint256"},{"internalType": "uint256","name": "_toTime","type": "uint256"}],"name": "getGeneratedReward","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "contract IERC20","name": "_token","type": "address"},{"internalType": "uint256","name": "amount","type": "uint256"},{"internalType": "address","name": "to","type": "address"}],"name": "governanceRecoverUnsupported","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "massUpdatePools","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "operator","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_pid","type": "uint256"},{"internalType": "address","name": "_user","type": "address"}],"name": "pendingShare","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "poolEndTime","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "","type": "uint256"}],"name": "poolInfo","outputs": [{"internalType": "contract IERC20","name": "token","type": "address"},{"internalType": "uint256","name": "allocPoint","type": "uint256"},{"internalType": "uint256","name": "lastRewardTime","type": "uint256"},{"internalType": "uint256","name": "accWinePerShare","type": "uint256"},{"internalType": "bool","name": "isStarted","type": "bool"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "poolStartTime","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "runningTime","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_pid","type": "uint256"},{"internalType": "uint256","name": "_allocPoint","type": "uint256"}],"name": "set","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_operator","type": "address"}],"name": "setOperator","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "totalAllocPoint","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_pid","type": "uint256"}],"name": "updatePool","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "","type": "uint256"},{"internalType": "address","name": "","type": "address"}],"name": "userInfo","outputs": [{"internalType": "uint256","name": "amount","type": "uint256"},{"internalType": "uint256","name": "rewardDebt","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "wine","outputs": [{"internalType": "contract IERC20","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "winePerSecond","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_pid","type": "uint256"},{"internalType": "uint256","name": "_amount","type": "uint256"}],"name": "withdraw","outputs": [],"stateMutability": "nonpayable","type": "function"}];
const QUANTUM = "0xfB3D07e38Aa0b378e2978A01B09A724FAad9a693";
const QUANTUM_ABI = [{"inputs": [{"internalType": "address","name": "_cellar","type": "address"},{"internalType": "address","name": "_vineyard","type": "address"},{"internalType": "address","name": "_token","type": "address"},{"internalType": "uint256","name": "_id","type": "uint256"}],"stateMutability": "nonpayable","type": "constructor"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "previousOwner","type": "address"},{"indexed": true,"internalType": "address","name": "newOwner","type": "address"}],"name": "OwnershipTransferred","type": "event"},{"inputs": [],"name": "accShare","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"components": [{"internalType": "uint256","name": "count","type": "uint256"},{"internalType": "uint256","name": "mean","type": "uint256"},{"internalType": "uint256","name": "M2","type": "uint256"}],"internalType": "struct VarianceAggregator","name": "v","type": "tuple"},{"internalType": "uint256","name": "newValue","type": "uint256"}],"name": "aggregateVariance","outputs": [{"components": [{"internalType": "uint256","name": "count","type": "uint256"},{"internalType": "uint256","name": "mean","type": "uint256"},{"internalType": "uint256","name": "M2","type": "uint256"}],"internalType": "struct VarianceAggregator","name": "","type": "tuple"}],"stateMutability": "pure","type": "function"},{"inputs": [],"name": "averageRatio","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "balanceSigma2","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "balanceSigmaRatio","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "cellarRatio","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"},{"internalType": "uint256","name": "timestamp","type": "uint256"}],"name": "claimSigma2","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"},{"internalType": "uint256","name": "timestamp","type": "uint256"}],"name": "claimSigmaRatio","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_to","type": "uint256"},{"internalType": "uint256","name": "_from","type": "uint256"}],"name": "claimsPerDay","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "pure","type": "function"},{"inputs": [],"name": "contractBalance","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "contractShare","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "contractSupply","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "deposit","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "emergencyWithdraw","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "enabled","outputs": [{"internalType": "bool","name": "","type": "bool"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "frozenRatio","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"components": [{"internalType": "uint256","name": "count","type": "uint256"},{"internalType": "uint256","name": "mean","type": "uint256"},{"internalType": "uint256","name": "M2","type": "uint256"}],"internalType": "struct VarianceAggregator","name": "v","type": "tuple"},{"internalType": "uint256","name": "value","type": "uint256"}],"name": "getStdDev","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "pure","type": "function"},{"inputs": [],"name": "lastRewardTime","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "owner","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "pendingBonus","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "pendingShare","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_new","type": "uint256"},{"internalType": "uint256","name": "_old","type": "uint256"},{"internalType": "uint256","name": "numer","type": "uint256"},{"internalType": "uint256","name": "denom","type": "uint256"}],"name": "proportionalSum","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "pure","type": "function"},{"inputs": [],"name": "renounceOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "count","type": "uint256"},{"internalType": "uint256","name": "mean","type": "uint256"},{"internalType": "uint256","name": "M2","type": "uint256"}],"name": "setBalanceVariance","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "bool","name": "_enabled","type": "bool"}],"name": "setEnabled","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "count","type": "uint256"},{"internalType": "uint256","name": "mean","type": "uint256"},{"internalType": "uint256","name": "M2","type": "uint256"}],"name": "setclaimSigma2","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "account","type": "address"}],"name": "thawedRatio","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "newOwner","type": "address"}],"name": "transferOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "update","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "","type": "address"}],"name": "user","outputs": [{"internalType": "uint256","name": "index","type": "uint256"},{"internalType": "uint256","name": "balance","type": "uint256"},{"internalType": "uint256","name": "debt","type": "uint256"},{"internalType": "uint256","name": "ratio","type": "uint256"},{"internalType": "uint256","name": "timestamp","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "userCount","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "","type": "uint256"}],"name": "userList","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "varianceBalances","outputs": [{"internalType": "uint256","name": "count","type": "uint256"},{"internalType": "uint256","name": "mean","type": "uint256"},{"internalType": "uint256","name": "M2","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "varianceClaims","outputs": [{"internalType": "uint256","name": "count","type": "uint256"},{"internalType": "uint256","name": "mean","type": "uint256"},{"internalType": "uint256","name": "M2","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "vineyardBalance","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "vineyardPending","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "wineBalance","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "withdraw","outputs": [],"stateMutability": "nonpayable","type": "function"}];
const BANK = "0xC164060edb424Ff244705401260C58939FD3f0f3";
const BANK_ABI = [{"inputs": [{"internalType": "address","name": "_cellar","type": "address"}],"stateMutability": "nonpayable","type": "constructor"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "previousOwner","type": "address"},{"indexed": true,"internalType": "address","name": "newOwner","type": "address"}],"name": "OwnershipTransferred","type": "event"},{"inputs": [{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "adminPerDiem","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "emergencyWithdraw","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "owner","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "renounceOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "requestPerDiem","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "_cellar","type": "address"}],"name": "setCellarContract","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "newOwner","type": "address"}],"name": "transferOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"}];

var wine = null, vintage = null, cellar = null, vineyard = null;
var quantum = null;
var account;

const update = async() => {
	await switchNetwork(CHAIN_ID); // Make sure we're on the c-chain
	
	// Get the connected account
	await window.web3.eth.getAccounts().then(function(result) {
		account = result[0];
	});		
	document.getElementById("address").innerHTML = account.substring(0, 6)+"..."+account.substring(38, 42);
	
}

const main = async () => {
	if(await Web3Enabled()) { // Initialize web3 and connected to metamask		
		wine = new window.web3.eth.Contract(WINE_TOKEN_ABI, WINE_TOKEN);
		vintage = new window.web3.eth.Contract(VINTAGE_TOKEN_ABI, VINTAGE_TOKEN);
		cellar = new window.web3.eth.Contract(CELLAR_ABI, CELLAR);
		vineyard = new window.web3.eth.Contract(VINEYARD_ABI, VINEYARD);
		quantum = new window.web3.eth.Contract(QUANTUM_ABI, QUANTUM);
		bank = new window.web3.eth.Contract(BANK_ABI, BANK);
		
		let wine_balance = 0;
		let vintage_balance = 0;
		let cellar_balance = 0;
		let vineyard_balance = 0;
	
		update();		
		setInterval(async() => {
			update();			
		}, 5000);
	}
}

const showPreview = async(img) => {
	$("#preview").html("<img src='" + img + "' />");
	$("#preview").fadeIn();	
}

const hidePanels = async() => {
	$(document).mouseup(function (e) {
		if ($(e.target).closest("#preview").length
					=== 0) {
			$("#preview").fadeOut();
		}		
	});
}

var test_vault = '<div class="vaultbox"><div style="display: flex"><div class="vault-image"><img id="vault-test2" src="bg.png" /></div><div class="vault-info" ><div>Aikonic NFT Name</div><hr><div>Unlocked? Yes</div><div>Minimum Stake: 15 GRAPE</div><div>Staked: 150 GRAPE</div><div>Time Bonus: 2x</div><div>NFT Timer: 12d:18h:36m:54s</div><div>Claimable on: 10/18/2022</div><hr></div></div><div style="width: 100%; height: 48px;" ><div class="buttonbox"><div class="button">Deposit</div><div class="button">Withdraw</div><div class="button">Claim NFT</div></div></div></div>'

const createVaultPanel = function(vaultName, colIdx) {
	console.log(vaultName);
	let vault = '<div class="vaultbox"><div style="display: flex"><div class="vault-image"><img id="vault-' +
					vaultName +
					'" onclick="showPreview(\'bg.png\')" src="bg.png" /></div><div class="vault-info" ><div>Aikonic NFT Name</div><hr><div>Unlocked? Yes</div><div>Minimum Stake: 15 GRAPE</div><div>Staked: 150 GRAPE</div><div>Time Bonus: 2x</div><div>NFT Timer: 12d:18h:36m:54s</div><div>Claimable on: 10/18/2022</div><hr></div></div><div style="width: 100%; height: 80px;" ><div class="buttonbox"><div><div class="button shadow">Deposit</div><div class="button shadow">Withdraw</div></div><div><input id="vault-input-' + vaultName + '" type="textarea" placeholder="0.00" style="font-size: 16px; width: 100px; padding: 4px 8px 4px 8px; text-align: right; border-radius: 5px;" /></div><div class="button shadow">Claim NFT</div></div></div></div>'
	if(colIdx === 0) {
		$("#vaults-col-left").html($("#vaults-col-left").html() + vault);	
	} else {
		$("#vaults-col-right").html($("#vaults-col-right").html() + vault);	
	}
	
}

$(document).ready(function() {
/*	$("#btnClaim").click(quantumClaim);
	$("#btnAllowance").click(allowance);
	$("#btnShowWithdraw").click(showWithdrawPanel);
	$("#btnShowDeposit").click(showDepositPanel);
	$("#btnPerDiem").click(requestPerDiem);
	*/
	//$("#vaults-col-right").html($("#vaults-col-right").html() + test_vault);	
	//$("#vault-test2").click({ img: "bg.png" }, showPreview);
	//for(i = 0; i < 2; i++) {
	//	createVaultPanel(i.toString(), i % 2);
	//}	
	main();
	$("#button-connect").click(main);
});
</script>

<div class="bgimage">
</div>

<div class="menubar">
	<div style="display: flex">
		<div style="margin: 0 0 0 16px; height: 100%; line-height: 48px;">About</div>
		<div style="margin: 0 0 0 16px; height: 100%; line-height: 48px;">|</div>
		<div style="margin: 0 0 0 16px; height: 100%; line-height: 48px;">Twitter</div>
		
		<div id="button-connect" style="position: absolute; line-height: 48px; right: 16px; background: black; width: 125px; border-radius: 0 28px 28px 0;">
			<div style="position: absolute; left: -56px; background: black; padding: 0 0 0 8px; border-radius: 28px 0 0 28px;">
				<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/MetaMask_Fox.svg/1200px-MetaMask_Fox.svg.png" style="width: 48px; height: 48px" />
			</div>
			<div id="address">Connect</div>
		</div>
	</div>	
</div>

<div class="main-container">
	<div class="groupbox shadow" style="text-align: center;">		
		<div>
			<img src="logo.png" style="width: 400px; height: 150px;" />
			<hr>
			Stake your tokens, earn my NFTs!
		</div>
		<div class="vault-container">
			<div style="display: flex">
<!-- Column 1 -->
				<div id="vaults-col-left">
					<div class="vaultbox">
						<div style="display: flex">
							<div class="vault-image">
								<img id="vault-' + vaultName + '" onclick="showPreview(\'bg.png\')" src="bg.png" />
							</div>
							<div class="vault-info" >
								<div>Aikonic NFT Name</div>
								<hr>
								<div>Unlocked? Yes</div>
								<div>Minimum Stake: 15 GRAPE</div>
								<div>Staked: 150 GRAPE</div>
								<div>Time Bonus: 2x</div>
								<div>NFT Timer: 12d:18h:36m:54s</div>
								<div>Claimable on: 10/18/2022</div>
								<hr>
							</div>
						</div>
						<div style="width: 100%; height: 80px;" >
							<div id="buttons-unlock" class="buttonbox">
								<div class="button shadow">Unlock</div><div style="width: 100px">Unlock Fee:</div><div style="width: 75px"> .33 AVAX</div>
							</div>
							<div id="buttons-all" class="buttonbox" style="visibility: hidden;">
								<div>
									<div class="button shadow">Deposit</div>
									<div class="button shadow">Withdraw</div>
								</div>
								<div>
									<input id="vault-input-' + vaultName + '" type="textarea" placeholder="0.00" style="font-size: 16px; width: 132px; padding: 4px 8px 4px 8px; text-align: right; border-radius: 5px;" />
								</div>
								<div class="button shadow">
									Claim NFT
								</div>
							</div>
						</div>
					</div>
				</div>
								
<!-- Column 2 -->
				<div id="vaults-col-right" style="margin-left: 16px">
					
				</div>
			</div>
		</div>
	</div>
</div>

<div id="preview" class="previewbox shadow"><img src="bg.png" /></div>

<div id="errorbox" class="error-panel shadow">
<div class="superstar" style="color: #FFBAFF; font-size: 64px;">Error!</div>
<div id="errormsg"></div>
</div>

</body>
</html>